# 📖 完整使用说明

## 🎯 工具概述

这是一个为你定制的 **Chrome ⇄ Atlas 书签同步工具**，解决你提出的问题：
- ✅ 保持 Chrome 和 Atlas 书签完全同步
- ✅ 自动检测哪个浏览器的书签是最新的
- ✅ 智能合并，不会丢失任何书签
- ✅ 可以设置自动同步，无需手动操作

---

## 📦 工具包含的文件

```
bookmark-sync/
├── 📄 sync_bookmarks.py      # 核心同步脚本（Python）
├── 🚀 run_sync.sh            # 手动运行脚本
├── ⚙️  setup_auto_sync.sh     # 设置自动同步
├── 📖 README.md              # 详细文档
├── 🚀 快速开始.md             # 新手指南
├── 🔧 故障排查.md             # 问题解决
└── 📖 使用说明.md             # 本文件
```

---

## 🚀 三步开始使用

### 第 1 步：首次测试

打开终端（Terminal），输入：

```bash
cd ~/cursor/日常提问/bookmark-sync
./run_sync.sh
```

**预期结果：**
```
================================================
  🔖 浏览器书签同步工具
  Chrome ⇄ Atlas
================================================

✓ Chrome 书签: [路径]
✓ Atlas 书签: [路径]

正在备份...
正在加载书签...
正在合并书签...
正在保存同步结果...

================================================
✅ 书签同步完成！
================================================
```

### 第 2 步：设置自动同步

如果第 1 步成功，继续运行：

```bash
./setup_auto_sync.sh
```

**预期结果：**
```
================================================
✅ 定时任务设置成功！
================================================

📋 任务详情:
   - 执行频率: 每小时
   - 脚本位置: [路径]
   - 日志位置: ~/bookmark-sync-backups/
```

### 第 3 步：验证效果

1. 在 **Atlas** 中添加一个测试书签（比如 `https://test.com`）
2. 运行一次同步：`./run_sync.sh`
3. 打开 **Chrome**，查看书签栏是否出现了这个书签

✅ **如果看到了，说明同步成功！**

---

## 📱 日常使用

设置自动同步后，你**什么都不用做**：

1. 在 Chrome 或 Atlas **随意添加/删除/修改书签**
2. 系统每小时自动同步一次
3. 重启浏览器后，另一个浏览器的书签就更新了

**就这么简单！** 🎉

---

## 🔍 工作原理（技术细节）

### 同步逻辑

```
┌─────────────┐         ┌─────────────┐
│   Chrome    │         │    Atlas    │
│  书签文件   │         │  书签文件   │
└──────┬──────┘         └──────┬──────┘
       │                       │
       │  ① 读取书签           │
       ├───────────────────────┤
       │                       │
       │  ② 比较修改时间       │
       │     找出差异          │
       │                       │
       │  ③ 智能合并           │
       │   - 保留最新的书签     │
       │   - 添加新增的书签     │
       │   - 删除已删除的书签   │
       │                       │
       │  ④ 双向写入           │
       ├───────────────────────┤
       │                       │
   ┌───▼───┐               ┌───▼───┐
   │ 更新  │               │ 更新  │
   │完成！ │               │完成！ │
   └───────┘               └───────┘
```

### 冲突处理规则

| 情况 | 处理方式 |
|------|---------|
| 两边都有相同书签 | 保留修改时间较新的版本 |
| 只有 Chrome 有 | 添加到 Atlas |
| 只有 Atlas 有 | 添加到 Chrome |
| 两边时间相同 | 保持不变 |

---

## 🛡️ 安全保障

### 自动备份
- 每次同步前自动备份两个浏览器的书签
- 备份位置：`~/bookmark-sync-backups/`
- 备份命名：`chrome_bookmarks_20250127_143022.json`

### 恢复方法
```bash
# 查看所有备份
ls -lt ~/bookmark-sync-backups/*.json

# 恢复 Chrome 书签
cp ~/bookmark-sync-backups/chrome_bookmarks_时间戳.json \
   ~/Library/Application\ Support/Google/Chrome/Default/Bookmarks

# 重启 Chrome
```

---

## ⚙️ 高级配置

### 修改同步频率

默认每小时同步一次，如果你觉得太频繁或太慢：

```bash
nano ~/Library/LaunchAgents/com.bookmarksync.plist
```

找到这一行：
```xml
<key>StartInterval</key>
<integer>3600</integer>   <!-- 修改这个数字 -->
```

改成：
- `1800` = 30 分钟
- `7200` = 2 小时
- `43200` = 12 小时

保存后重新加载：
```bash
launchctl unload ~/Library/LaunchAgents/com.bookmarksync.plist
launchctl load ~/Library/LaunchAgents/com.bookmarksync.plist
```

### 手动指定 Atlas 路径

如果脚本找不到 Atlas 书签，编辑 `sync_bookmarks.py`：

```bash
nano sync_bookmarks.py
```

找到第 14 行左右，添加你的路径：
```python
atlas_paths = [
    Path.home() / "你的Atlas路径/Bookmarks",  # 添加这行
    # ... 其他路径
]
```

---

## 📊 监控和日志

### 查看同步状态
```bash
# 最近 20 条同步记录
tail -20 ~/bookmark-sync-backups/sync.log

# 实时监控（按 Ctrl+C 退出）
tail -f ~/bookmark-sync-backups/sync.log
```

### 查看定时任务状态
```bash
# 检查任务是否在运行
launchctl list | grep bookmarksync

# 查看定时任务日志
tail ~/bookmark-sync-backups/launchd.log
```

---

## 🎛️ 管理命令速查

```bash
# 手动同步
cd ~/cursor/日常提问/bookmark-sync && ./run_sync.sh

# 停止自动同步
launchctl unload ~/Library/LaunchAgents/com.bookmarksync.plist

# 启动自动同步
launchctl load ~/Library/LaunchAgents/com.bookmarksync.plist

# 查看日志
tail -50 ~/bookmark-sync-backups/sync.log

# 清理旧备份（保留最近 30 天）
find ~/bookmark-sync-backups/ -name "*.json" -mtime +30 -delete

# 查看备份占用空间
du -sh ~/bookmark-sync-backups/
```

---

## ❓ 常见问题快速解答

### Q: 同步后要重启浏览器吗？
**A:** 是的，浏览器缓存了书签，必须完全退出后重新打开。

### Q: 会丢失书签吗？
**A:** 不会。每次同步前都会自动备份，而且是双向合并，不是覆盖。

### Q: 可以同步多台电脑吗？
**A:** 每台电脑需要单独设置这个脚本。书签会在每台电脑的 Chrome 和 Atlas 之间同步。

### Q: 删除的书签会同步吗？
**A:** 会。如果你在 Chrome 删除了某个书签，下次同步后 Atlas 的这个书签也会被删除。

### Q: 支持书签文件夹吗？
**A:** 支持！包括多层嵌套的文件夹。

---

## 🆘 遇到问题？

1. **查看**：[故障排查.md](故障排查.md) - 详细的问题解决指南
2. **检查**：`~/bookmark-sync-backups/sync.log` - 同步日志
3. **恢复**：从备份文件恢复（见上文"安全保障"部分）

---

## 📈 推荐使用流程

### 每天使用
- 不需要任何操作，自动同步已设置

### 每周检查（可选）
```bash
# 查看同步是否正常
tail -20 ~/bookmark-sync-backups/sync.log
```

### 每月维护（可选）
```bash
# 清理旧备份（保留最近 30 天）
find ~/bookmark-sync-backups/ -name "*.json" -mtime +30 -delete

# 手动导出书签作为额外备份
# Chrome: 书签管理器 → 导出书签
```

---

## 🎓 技术说明

### 系统要求
- macOS（已在你的系统测试：darwin 25.1.0）
- Python 3（macOS 自带）
- Chrome 浏览器（已安装）
- Atlas 浏览器（需要已安装）

### 使用的技术
- **Python 3**：核心同步逻辑
- **JSON**：书签数据格式
- **macOS LaunchAgent**：定时任务
- **文件系统操作**：直接读写书签文件

### 为什么不用浏览器插件？
- Atlas 可能还不支持扩展
- 直接操作文件更可靠、更快速
- 可以在后台自动运行，不需要打开浏览器

---

## 📚 扩展阅读

- [README.md](README.md) - 完整的技术文档
- [快速开始.md](快速开始.md) - 最简单的入门指南
- [故障排查.md](故障排查.md) - 问题解决大全

---

## 🎉 总结

你现在拥有一个**完全自动化**的书签同步工具：

✅ 双向同步 Chrome ⇄ Atlas  
✅ 智能合并，以最新的为准  
✅ 自动备份，数据安全  
✅ 定时运行，无需人工干预  
✅ 完整日志，便于追踪  

**从现在开始，你只需要在任何一个浏览器管理书签，另一个会自动同步！** 🚀

---

**祝使用愉快！有问题随时查看文档或日志。** 😊

